name: "Acceptance Test Action"
description: "Run acceptance tests for a resource"
author: "MongoDB"
inputs:
  forceTestAcc:
    description: "if unconditionally trigger tests"
    required: true
  filters:
    description: "files to detect if tests should be run"
    required: true
  testRegex:
    description: "regular expression for test methods"
    required: true
runs:
  using: "composite"
  steps:
    - name: Filter src files
      uses: dorny/paths-filter@v2
      id: filter
      with:
        filters: ${{ inputs.filters }}
    - name: Print params
      shell: bash
      run: |
        echo forceTestAcc: ${{ inputs.forceTestAcc }}.
        echo filters: ${{ inputs.filters }}.
        echo testRegex: ${{ inputs.testRegex }}.
        echo Files modified: ${{ steps.filter.outputs.src }}.
        echo Files modified2: ${{ steps.filter.outputs.src == 'true' }}.
        echo if: ${{ inputs.forceTestAcc || steps.filter.outputs.src == 'true'}}.
    - name: Set up Go
      if: ${{ inputs.forceTestAcc || steps.filter.outputs.src == 'true'}}
      uses: actions/setup-go@v4
      with:
        go-version-file: "go.mod"
    - name: Acceptance Tests
      if: ${{ inputs.forceTestAcc || steps.filter.outputs.src == 'true'}}
      env:
        TEST_REGEX: ${{ inputs.testRegex }}
      shell: bash
      run: make testacc
